# Telegraf Configuration for SNMP Monitoring

[global_tags]
  service = "telegraf-snmp"
  environment = "production"

[agent]
  interval = "${TELEGRAF_SNMP_INTERVAL}"
  round_interval = true
  metric_batch_size = 1000
  metric_buffer_limit = 10000
  collection_jitter = "0s"
  flush_interval = "10s"
  flush_jitter = "0s"
  precision = "s"
  hostname = ""
  omit_hostname = false
  debug = ${TELEGRAF_DEBUG}
  quiet = ${TELEGRAF_QUIET}

[[outputs.influxdb_v2]]
  urls = ["${INFLUX_URL}"]
  token = "${INFLUX_TOKEN}"
  organization = "${INFLUX_ORG}"
  bucket = "${INFLUX_BUCKET}"
  timeout = "30s"

# SNMP Input Plugin
[[inputs.snmp]]
  # List of agents to poll
  agents = [ ${TELEGRAF_SNMP_AGENTS} ]
  
  # Timeout for each request
  timeout = "10s"
  
  # SNMP version
  version = ${TELEGRAF_SNMP_VERSION}
  
  # SNMP community string (for v1 and v2c)
  community = "${TELEGRAF_SNMP_COMMUNITY}"
  
  # Number of retries
  retries = 3
  
  # SNMP v3 auth parameters
  #sec_name = "${TELEGRAF_SNMP_SEC_NAME}"
  #auth_protocol = "${TELEGRAF_SNMP_AUTH_PROTOCOL}"
  #auth_password = "${TELEGRAF_SNMP_AUTH_PASSWORD}"
  #sec_level = "${TELEGRAF_SNMP_SEC_LEVEL}"
  #priv_protocol = "${TELEGRAF_SNMP_PRIV_PROTOCOL}"
  #priv_password = "${TELEGRAF_SNMP_PRIV_PASSWORD}"

  # measurement name
  name = "snmp"

  # System information
  [[inputs.snmp.field]]
    name = "hostname"
    oid = "SNMPv2-MIB::sysName.0"
    is_tag = true

  [[inputs.snmp.field]]
    name = "sysUpTime"
    oid = "SNMPv2-MIB::sysUpTime.0"

  [[inputs.snmp.field]]
    name = "sysDescr"
    oid = "SNMPv2-MIB::sysDescr.0"

  # Interface Statistics
  [[inputs.snmp.table]]
    name = "interface"
    inherit_tags = ["hostname"]
    oid = "IF-MIB::ifTable"

    [[inputs.snmp.table.field]]
      name = "ifDescr"
      oid = "IF-MIB::ifDescr"
      is_tag = true

    [[inputs.snmp.table.field]]
      name = "ifOperStatus"
      oid = "IF-MIB::ifOperStatus"

    [[inputs.snmp.table.field]]
      name = "ifInOctets"
      oid = "IF-MIB::ifInOctets"

    [[inputs.snmp.table.field]]
      name = "ifOutOctets"
      oid = "IF-MIB::ifOutOctets"

    [[inputs.snmp.table.field]]
      name = "ifInErrors"
      oid = "IF-MIB::ifInErrors"

    [[inputs.snmp.table.field]]
      name = "ifOutErrors"
      oid = "IF-MIB::ifOutErrors"

  # CPU Usage (Cisco)
  [[inputs.snmp.field]]
    name = "cpmCPUTotal5min"
    oid = "1.3.6.1.4.1.9.9.109.1.1.1.1.5.1"

  # Memory Usage (Cisco)
  [[inputs.snmp.field]]
    name = "ciscoMemoryPoolUsed"
    oid = "1.3.6.1.4.1.9.9.48.1.1.1.5.1"

  [[inputs.snmp.field]]
    name = "ciscoMemoryPoolFree"
    oid = "1.3.6.1.4.1.9.9.48.1.1.1.6.1"

# Internal metrics
[[inputs.internal]]
  collect_memstats = true